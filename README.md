# SimpleMVC-example

Пример проекта, разработанного на учебном движке (MCV-фреймворке) [SimpleMVC](https://github.com/it-for-free/SimpleMVC).


## Установка
ВНИМАНИЕ: о composer-е и остальных моментах см. [в уроках по SimpleMVC](http://fkn.ktu10.com/?q=node/9429).

1. Делаем форк репозитория https://github.com/it-for-free/SimpleMVC-example  и клонируем его из своего гитхаб-профиля.
2. Создаём у себя на машине виртуальный хост с корнем в ддиректории `web/` проекта.
3. Подтягиваем зависимости композером:
``` 
composer install
```
4. Разворачиваем  приложенный дамп `basedump.sql`.
5. Создаём копию `application/config/web-local-example.php` в той же папке с названием `application/config/web-local.php` 
  и прописываем туда доступы к базе данных.

Открываем сайт в браузере. Удачной разработки!

## Использование примера

### Авторизационые данные

Используйте для авторизации:

* Логин: `admin`
* Пароль: `12345`


## Разработка

### Использование данных конфигурационного файла

Подключаем клсс для работы с даными конфига:

```php
use ItForFree\SimpleMVC\Config;
```

Получение класса объекта (например, пользователя):

```php
$User = Config::getObject('core.user.class');
```
получение элемента (без необъходимости инстанцировать класс с таким именем):

```php
$User = Config::get('путь.в.массиве.конфига');
```

### Работа с объектом User

Получить доступ к объекту-синглтону можно так (через конфиг):

```php
$User = Config::getObject('core.user.class');
```

### Система контроля доступа

Получить подробную инфромацию о том почему есть или нет доступа к какому-либо  маршрутут для данного пользователя можно распечатав данные метода:
```php
$User->explainAccess('/ваш/маршрут');
```

## ToDo

Что ещё надо улучшить/сделать (самсем универсальное выносим в rusphp остальное относится к ядру т.е. самому `SimpleMVC`):

* Добавить html-хэлпер (возм. с участием `rusphp`)
* Несовершенный контроль доступа -- rules лучше сделать методом (чтобы, возможно, что-то вычислять динамически). 
    Ввести пседонимы @ и ? для роли зарегистрированного пользователя и гостя.
* Сделать  отдачу `404` в ответ на найденные контроллеры или их действия, аналогично подумать над передачей кодов для других ошибок (`исключений SimpleMVC`)
* Возможно, надо пересмотреть свзимоотношения трейта конторля доступа, контроллера и класса пользоватлея 
    -- м.б. трейт надо вынуть из контроллера и сделать либо независимым либо перенести в класс пользователя.
* Проверить работу класса, управляющего сессией, на предмет блокировок и "в целом".
* ~~Добавить систему asset-ов, тогда напр. CSS и JS бутстрапа можно было бы вытягивать composer-ом~~ пакет уже есть, необходимо добработать и внедрить `it-for-free/php-simple-assets`
* Добавить класс (виджет) для работы с меню, который мог бы выставлять активный элемент, проверяя маршрут.
* Прикрутить миграции.
* Добавить виджет для "хлебных крошек".
* Создать отдельно класс модели и отдельно класс модели для работы с БД (наследющийся от 1-ого).
* Описать интерфейсы для всех классов приложения, перечисленных в конфиге.
* Сделать объекты конфигурабельными.
* Проверить возможность установки явного времени действия сессии (авторизация).
* Сделать обработку ситуации отсутствия доступа более "мягкой" (без вообще непрехватываемого исключения).
 

## Полезные материалы

* Документация по bootstrap4: https://getbootstrap.com/docs/4.1/layout/overview/
